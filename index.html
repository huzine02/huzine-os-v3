<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HUZINE OS // ULTIMATE</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            /* --- PALETTE PREMIUM (Linear/Vercel vibes) --- */
            --bg-deep: #030406;
            --bg-subtle: #0A0C10;
            --bg-panel: rgba(20, 23, 28, 0.6);
            --border-light: rgba(255, 255, 255, 0.08);
            
            /* Accents */
            --pro-blue: #3B82F6;
            --saas-green: #10B981;
            --patri-purple: #8B5CF6;
            --vie-pink: #EC4899;
            --warn-orange: #F59E0B;
            --alert-red: #EF4444;
            --star-gold: #FCD34D;
            
            --text-main: #F1F5F9;
            --text-muted: #94A3B8;
            --text-dim: #475569;

            /* System */
            --radius-sm: 6px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --font-ui: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }

        body {
            background-color: var(--bg-deep);
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(59, 130, 246, 0.08), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(16, 185, 129, 0.05), transparent 25%);
            color: var(--text-main);
            font-family: var(--font-ui);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

        /* --- HEADER --- */
        header#main-header {
            background: rgba(3, 4, 6, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-light);
            padding: 0 1.5rem;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 50;
        }
        
        header.crisis-active { border-bottom: 1px solid var(--alert-red); box-shadow: 0 4px 30px rgba(239, 68, 68, 0.2); }

        .brand { font-family: var(--font-mono); font-weight: 700; color: var(--text-main); font-size: 0.95rem; display: flex; align-items: center; gap: 10px; }
        .brand span { color: var(--text-muted); font-weight: 400; }
        
        .crisis-tag { background: rgba(239, 68, 68, 0.2); color: var(--alert-red); font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; font-weight: 700; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; } }

        /* INPUTS */
        .braindump-wrapper { flex: 1; max-width: 500px; margin: 0 2rem; position: relative; }
        .braindump-input {
            width: 100%; background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border-light);
            color: var(--text-main); padding: 10px 12px 10px 40px; border-radius: var(--radius-sm);
            font-family: var(--font-ui); font-size: 0.85rem; transition: all 0.2s ease;
        }
        .braindump-input:focus { background: rgba(255, 255, 255, 0.06); border-color: var(--text-muted); }
        .braindump-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-dim); }

        /* CONTROLS */
        .header-controls { display: flex; gap: 0.75rem; align-items: center; }
        .btn-header, .btn-icon {
            background: transparent; color: var(--text-muted); border: 1px solid var(--border-light);
            height: 32px; border-radius: var(--radius-sm); cursor: pointer; display: flex;
            align-items: center; justify-content: center; font-family: var(--font-ui);
            font-weight: 500; font-size: 0.75rem; transition: all 0.2s;
        }
        .btn-header { padding: 0 12px; gap: 6px; }
        .btn-icon { width: 32px; }
        .btn-header:hover, .btn-icon:hover { background: rgba(255,255,255,0.05); color: var(--text-main); border-color: var(--text-muted); }
        
        .btn-header.focus-active { background: var(--saas-green); color: #000; border-color: var(--saas-green); box-shadow: 0 0 15px rgba(16, 185, 129, 0.2); }
        .btn-header.crisis.active { background: var(--alert-red); color: white; border-color: var(--alert-red); }
        #clock { font-family: var(--font-mono); font-weight: 600; font-size: 0.85rem; color: var(--text-main); margin-right: 0.5rem; }

        /* LAYOUT */
        .container { display: flex; flex: 1; overflow: hidden; }
        .sidebar { 
            width: 72px; background: rgba(3, 4, 6, 0.5); border-right: 1px solid var(--border-light); 
            display: flex; flex-direction: column; align-items: center; padding-top: 1.5rem; gap: 0.5rem; z-index: 40;
        }
        .nav-item { 
            width: 44px; height: 44px; border-radius: 10px; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; cursor: pointer; color: var(--text-dim); 
            transition: all 0.3s; font-size: 0.6rem; gap: 2px; font-weight: 500; position: relative;
        }
        .nav-item i { font-size: 1.2rem; margin-bottom: 2px; }
        .nav-item:hover { color: var(--text-main); background: rgba(255,255,255,0.05); }
        .nav-item.active { color: var(--text-main); background: rgba(255,255,255,0.08); }
        .nav-item.active::before {
            content: ''; position: absolute; left: -14px; top: 12px; bottom: 12px; width: 3px;
            background: var(--text-main); border-radius: 0 4px 4px 0;
        }

        /* MAIN */
        .main-content { flex: 1; padding: 2rem 3rem; overflow-y: auto; background: radial-gradient(circle at top center, rgba(255,255,255,0.02), transparent 70%); }
        .view-section { display: none; animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* DASHBOARD */
        .cockpit-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 2rem; }
        .day-badge { padding: 6px 12px; border-radius: 100px; font-weight: 700; text-transform: uppercase; font-size: 0.7rem; display: inline-flex; align-items: center; gap: 8px; color: white; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .greeting { color: var(--text-muted); font-size: 1.1rem; font-weight: 300; margin-top: 5px; }
        .greeting span { color: var(--text-main); font-weight: 500; }

        /* TOP 3 */
        .top3-card {
            background: linear-gradient(180deg, rgba(20, 23, 28, 0.4), rgba(20, 23, 28, 0.8));
            border: 1px solid rgba(252, 211, 77, 0.3); border-radius: var(--radius-md); 
            padding: 1.25rem; margin-bottom: 2rem; position: relative; overflow: hidden;
            box-shadow: 0 0 30px rgba(252, 211, 77, 0.05);
        }
        .top3-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, var(--star-gold), transparent); opacity: 0.5;
        }
        .top3-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .top3-title { font-weight: 700; font-size: 0.8rem; color: var(--star-gold); letter-spacing: 0.05em; display: flex; align-items: center; gap: 8px; }
        .top3-count { font-family: var(--font-mono); font-size: 0.75rem; color: var(--text-muted); background: rgba(255,255,255,0.05); padding: 2px 6px; border-radius: 4px; }
        .top3-list { display: flex; flex-direction: column; gap: 8px; }
        .top3-empty { color: var(--text-dim); font-size: 0.85rem; font-style: italic; opacity: 0.7; padding: 10px; border: 1px dashed var(--border-light); text-align: center; }

        /* PILLARS */
        .pillar-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.25rem; margin-bottom: 2rem; }
        .pillar-card {
            background: var(--bg-panel); backdrop-filter: blur(12px); border: 1px solid var(--border-light);
            border-radius: var(--radius-md); padding: 1.25rem; display: flex; flex-direction: column;
            transition: all 0.3s ease; min-height: 240px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .pillar-card.focus { opacity: 1; box-shadow: 0 10px 40px rgba(0,0,0,0.3); transform: translateY(-2px); }
        .pillar-card.medium { opacity: 0.85; filter: grayscale(0.2); }
        .pillar-card.light { opacity: 0.6; filter: grayscale(0.5); }
        .pillar-card.faded { opacity: 0.4; filter: grayscale(0.8); }
        
        .pillar-card.focus { border-color: var(--theme); box-shadow: 0 0 20px -5px var(--theme); }
        .pillar-focus-tag { position: absolute; top: 12px; right: 12px; background: var(--theme); color: #000; font-size: 0.6rem; font-weight: 800; padding: 3px 8px; border-radius: 100px; }

        .pillar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border-light); }
        .pillar-title { font-weight: 600; font-size: 0.9rem; color: var(--text-main); display: flex; align-items: center; gap: 8px; }
        .pillar-badge { font-family: var(--font-mono); font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; background: rgba(255,255,255,0.05); color: var(--text-muted); }
        .pillar-tasks { flex: 1; display: flex; flex-direction: column; gap: 2px; }

        /* TASKS */
        .task-row { display: flex; align-items: center; padding: 8px 10px; border-radius: var(--radius-sm); transition: all 0.2s; border: 1px solid transparent; }
        .task-row:hover { background: rgba(255,255,255,0.03); border-color: rgba(255,255,255,0.05); }
        .task-check { appearance: none; width: 18px; height: 18px; border: 1.5px solid var(--text-muted); border-radius: 5px; margin-right: 12px; cursor: pointer; position: relative; flex-shrink: 0; }
        .task-check:checked { background: var(--saas-green); border-color: var(--saas-green); }
        .task-check:checked::after { content: ''; position: absolute; left: 5px; top: 2px; width: 4px; height: 8px; border: solid black; border-width: 0 2px 2px 0; transform: rotate(45deg); }
        .task-content { flex: 1; font-size: 0.85rem; color: var(--text-main); cursor: pointer; }
        .task-done .task-content { text-decoration: line-through; color: var(--text-dim); }
        .task-star { background: none; border: none; cursor: pointer; font-size: 1rem; color: var(--text-dim); opacity: 0.5; margin-left: 8px; }
        .task-row:hover .task-star { opacity: 1; }
        .task-star.active { color: var(--star-gold); opacity: 1; transform: scale(1.1); }
        .task-delete { background: none; border: none; color: var(--alert-red); cursor: pointer; opacity: 0; margin-left: 8px; }
        .task-row:hover .task-delete { opacity: 0.5; }
        .task-delete:hover { opacity: 1; }
        
        .add-task-btn { width: 100%; padding: 10px; margin-top: 12px; background: rgba(255,255,255,0.02); border: 1px dashed var(--border-light); color: var(--text-muted); cursor: pointer; border-radius: var(--radius-sm); font-size: 0.75rem; transition: all 0.2s; font-weight: 500; }
        .add-task-btn:hover { background: rgba(255,255,255,0.05); border-color: var(--text-muted); color: var(--text-main); }

        /* JOURNAL */
        .journal-section { background: var(--bg-panel); border: 1px solid var(--border-light); border-radius: var(--radius-md); overflow: hidden; margin-top: 2rem; }
        .journal-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.25rem; cursor: pointer; transition: background 0.2s; }
        .journal-header:hover { background: rgba(255,255,255,0.02); }
        .journal-title { font-size: 0.8rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
        .journal-body { max-height: 0; overflow: hidden; transition: max-height 0.4s ease; padding: 0 1.25rem; }
        .journal-body.expanded { max-height: 300px; padding: 0 1.25rem 1.25rem 1.25rem; border-top: 1px solid var(--border-light); }
        .journal-input-row { display: flex; gap: 10px; margin-bottom: 12px; }
        .journal-input { flex: 1; background: var(--bg-subtle); border: 1px solid var(--border-light); border-radius: var(--radius-sm); padding: 8px 12px; color: var(--text-main); font-family: var(--font-ui); font-size: 0.85rem; }
        .journal-input:focus { border-color: var(--pro-blue); }
        .journal-entry { padding: 8px 0; border-bottom: 1px solid var(--border-light); font-size: 0.8rem; display: flex; gap: 12px; align-items: baseline; }
        .journal-time { color: var(--pro-blue); font-family: var(--font-mono); font-size: 0.7rem; opacity: 0.8; }

        /* TABLES */
        .smart-table { width: 100%; border-collapse: separate; border-spacing: 0; font-size: 0.85rem; }
        .smart-table th { text-align: left; padding: 12px 10px; color: var(--text-dim); border-bottom: 1px solid var(--border-light); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; }
        .smart-table td { padding: 10px; border-bottom: 1px solid var(--border-light); vertical-align: middle; }

        /* PROJECTS */
        .project-card { background: var(--bg-panel); border: 1px solid var(--border-light); border-radius: var(--radius-md); padding: 1.5rem; margin-bottom: 1.5rem; }
        .project-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .project-title { font-weight: 600; font-size: 1rem; color: var(--text-main); }
        .timeline-track { height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; margin: 12px 0 20px 0; overflow: hidden; }
        .timeline-bar { height: 100%; border-radius: 2px; background: linear-gradient(90deg, var(--pro-blue), var(--saas-green)); box-shadow: 0 0 10px rgba(16, 185, 129, 0.3); }
        .project-input { flex: 1; background: var(--bg-subtle); border: 1px solid var(--border-light); border-radius: var(--radius-sm); padding: 8px 12px; color: var(--text-main); font-size: 0.85rem; }

        /* WEEK GRID */
        .week-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-top: 1.5rem; }
        .week-day { background: rgba(255,255,255,0.02); border: 1px solid var(--border-light); border-radius: var(--radius-sm); padding: 1rem 0.5rem; text-align: center; }
        .week-day.today { background: rgba(16, 185, 129, 0.1); border-color: var(--saas-green); }
        .week-day-name { font-weight: 700; font-size: 0.85rem; margin-bottom: 4px; }
        .week-day-theme { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; }

        /* TIMER & MODALS */
        .timer-float { position: fixed; bottom: 24px; right: 24px; background: #000; border: 1px solid var(--border-light); padding: 8px 16px; border-radius: 100px; display: flex; align-items: center; gap: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 100; transition: border 0.3s; }
        .timer-float.active { border-color: var(--saas-green); box-shadow: 0 0 20px rgba(16, 185, 129, 0.2); }
        .timer-time { font-family: var(--font-mono); font-size: 1.1rem; font-weight: 700; color: var(--text-main); }
        .timer-btn { color: var(--text-muted); font-size: 1rem; cursor: pointer; background: none; border: none; }
        .timer-btn:hover { color: var(--text-main); }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 999; display: none; justify-content: center; align-items: center; }
        .modal-overlay.show { display: flex; animation: fadeIn 0.2s ease; }
        .modal-content { text-align: center; max-width: 420px; width: 90%; padding: 2rem; border: 1px solid var(--border-light); background: #0A0C10; border-radius: var(--radius-lg); box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .shutdown-title { font-size: 1.5rem; font-weight: 800; color: var(--text-main); margin-bottom: 0.5rem; }
        .shutdown-subtitle { color: var(--text-muted); margin-bottom: 1.5rem; font-size: 0.9rem; }
        .import-area { width: 100%; height: 120px; background: rgba(255,255,255,0.03); border: 1px solid var(--border-light); color: var(--saas-green); font-family: var(--font-mono); font-size: 0.75rem; padding: 12px; border-radius: var(--radius-sm); margin-bottom: 1rem; resize: none; }
        .copy-prompt-btn { background: rgba(59, 130, 246, 0.1); color: var(--pro-blue); border: 1px solid rgba(59, 130, 246, 0.2); padding: 10px; width: 100%; border-radius: var(--radius-sm); font-weight: 600; font-size: 0.8rem; cursor: pointer; margin-bottom: 1rem; }
        .shutdown-btn { background: var(--text-main); color: #000; border: none; padding: 12px 24px; font-weight: 600; cursor: pointer; width: 100%; border-radius: var(--radius-sm); font-size: 0.9rem; }
        
        .focus-overlay { background: #030406; }
        .focus-task { font-size: 1.8rem; font-weight: 700; text-align: center; max-width: 700px; margin-bottom: 1.5rem; line-height: 1.2; background: linear-gradient(180deg, #fff, #888); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .focus-type { color: var(--pro-blue); letter-spacing: 0.1em; margin-bottom: 1rem; font-size: 0.9rem; }
        .focus-timer { font-size: 2.5rem; color: var(--text-main); font-weight: 500; margin-bottom: 2rem; font-family: var(--font-mono); }
        .focus-btn { padding: 14px 32px; border-radius: 100px; font-size: 0.95rem; border:none; cursor: pointer; }
        .focus-btn.primary { background: var(--text-main); color: black; }
        .focus-btn.secondary { background: transparent; border: 1px solid var(--border-light); color: var(--text-muted); }

        .hidden { display: none !important; }
        @media (max-width: 768px) { .sidebar { width: 60px; } .braindump-wrapper { display: none; } .pillar-grid { grid-template-columns: 1fr; } .week-grid { grid-template-columns: repeat(3, 1fr); } .main-content { padding: 1rem; } }
    </style>
</head>
<body>

<header id="main-header">
    <div class="brand">HUZINE<span>//OS</span><span class="crisis-tag hidden" id="crisis-tag">CRISE</span></div>
    <div class="braindump-wrapper">
        <span class="braindump-icon">‚ö°</span>
        <input type="text" id="braindump-input" class="braindump-input" placeholder="Capture rapide... (Entr√©e)">
    </div>
    <div class="header-controls">
        <div id="clock">00:00</div>
        <button class="btn-header" onclick="openAiImport()" style="border-color:var(--patri-purple); color:var(--patri-purple);" title="Import IA">üì• IMPORT IA</button>
        <button class="btn-header" id="btn-focus" onclick="toggleFocusMode()">üéØ FOCUS</button>
        <button class="btn-header crisis" id="btn-crisis" onclick="toggleCrisisMode()">üö®</button>
        <button class="btn-header" onclick="exportData()">üíæ</button>
        <button class="btn-icon" onclick="document.getElementById('import-file').click()">üìÇ</button>
        <input type="file" id="import-file" style="display:none" onchange="importData(this)">
    </div>
</header>

<div class="container">
    <nav class="sidebar">
        <div class="nav-item active" onclick="switchTab('dashboard', this)"><i>üöÄ</i><span>Day</span></div>
        <div class="nav-item" onclick="switchTab('pro', this)"><i>üíº</i><span>Pro</span></div>
        <div class="nav-item" onclick="switchTab('saas', this)"><i>üíª</i><span>SaaS</span></div>
        <div class="nav-item" onclick="switchTab('vie', this)"><i>üß¨</i><span>Vie</span></div>
        <div class="nav-item" onclick="switchTab('patrimoine', this)"><i>üèóÔ∏è</i><span>Patri</span></div>
        <div class="nav-item" onclick="switchTab('review', this)"><i>üìÖ</i><span>Plan</span></div>
    </nav>

    <main class="main-content">
        <!-- DASHBOARD -->
        <section id="view-dashboard" class="view-section active">
            <div class="cockpit-header">
                <div class="day-info">
                    <div id="day-badge" class="day-badge">CHARGEMENT...</div>
                    <div class="greeting"><span id="greeting-text">Bonjour</span>, Huzine.</div>
                </div>
                <button onclick="openShutdown()" class="btn-header" style="color:var(--warn-orange); border-color:var(--warn-orange);">üåô Shutdown</button>
            </div>

            <!-- TOP 3 -->
            <div class="top3-card">
                <div class="top3-header">
                    <span class="top3-title">‚≠ê TOP 3 DU JOUR</span>
                    <span class="top3-count" id="top3-count">0/3</span>
                </div>
                <div class="top3-list" id="top3-list"></div>
            </div>

            <!-- 4 PILLAR CARDS -->
            <div class="pillar-grid" id="pillar-grid"></div>

            <!-- JOURNAL -->
            <div class="journal-section">
                <div class="journal-header" onclick="toggleJournal()">
                    <span class="journal-title">üìù Journal de transition</span>
                    <span class="journal-toggle" id="journal-toggle">‚ñº Afficher</span>
                </div>
                <div class="journal-body" id="journal-body">
                    <div class="journal-input-row">
                        <input type="text" id="journal-input" class="journal-input" placeholder="Comment je me sens ?">
                        <button onclick="addJournalEntry()" class="btn-icon" style="width:32px;">+</button>
                    </div>
                    <div class="journal-entries" id="journal-entries"></div>
                </div>
            </div>
        </section>

        <!-- PRO -->
        <section id="view-pro" class="view-section">
            <h2 style="color:var(--pro-blue); margin-bottom:1rem; font-size:1.2rem; font-weight:700;">üíº PRO / Dell</h2>
            <div class="project-card">
                <table class="smart-table">
                    <thead><tr><th width="30"></th><th>T√¢che</th><th width="50">‚≠ê</th><th width="40"></th></tr></thead>
                    <tbody id="table-pro-body"></tbody>
                </table>
                <button onclick="addNewTask('pro')" class="add-task-btn">+ Ajouter t√¢che PRO</button>
            </div>
        </section>

        <!-- SAAS -->
        <section id="view-saas" class="view-section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h2 style="color:var(--saas-green); font-size:1.2rem; font-weight:700;">üíª SaaS / Nutri-Track</h2>
                <div style="display:flex; gap:6px;">
                    <input type="text" id="input-mrr" placeholder="MRR ‚Ç¨" style="background:var(--bg-subtle); border:1px solid var(--border-light); padding:5px 8px; color:white; width:80px; border-radius:4px; font-size:0.8rem;" onchange="updateMetrics()">
                    <input type="text" id="input-users" placeholder="Users" style="background:var(--bg-subtle); border:1px solid var(--border-light); padding:5px 8px; color:white; width:70px; border-radius:4px; font-size:0.8rem;" onchange="updateMetrics()">
                </div>
            </div>
            <div class="project-card">
                <table class="smart-table">
                    <thead><tr><th width="30"></th><th>Feature / T√¢che</th><th width="50">‚≠ê</th><th width="40"></th></tr></thead>
                    <tbody id="table-saas-body"></tbody>
                </table>
                <button onclick="addNewTask('saas')" class="add-task-btn">+ Ajouter t√¢che SaaS</button>
            </div>
        </section>

        <!-- VIE -->
        <section id="view-vie" class="view-section">
            <h2 style="color:var(--vie-pink); margin-bottom:1rem; font-size:1.2rem; font-weight:700;">üß¨ Vie / Admin</h2>
            <div class="project-card">
                <table class="smart-table">
                    <thead><tr><th width="30"></th><th>T√¢che</th><th width="50">‚≠ê</th><th width="40"></th></tr></thead>
                    <tbody id="table-vie-body"></tbody>
                </table>
                <button onclick="addNewTask('vie')" class="add-task-btn">+ Ajouter (docteur, admin...)</button>
            </div>
        </section>

        <!-- PATRIMOINE -->
        <section id="view-patrimoine" class="view-section">
            <h2 style="color:var(--patri-purple); margin-bottom:1rem; font-size:1.2rem; font-weight:700;">üèóÔ∏è Patrimoine</h2>
            
            <div class="project-card" style="border-left: 3px solid var(--patri-purple);">
                <div class="project-header">
                    <div class="project-title">üá©üáø Annaba</div>
                    <span style="font-size:0.7rem; color:var(--text-muted);">Fin: <input type="date" id="date-annaba" style="background:none; border:none; color:var(--text-main); font-size:0.7rem;" onchange="saveData()"></span>
                </div>
                <div class="timeline-track"><div class="timeline-bar" id="bar-annaba"></div></div>
                <div id="list-annaba"></div>
                <div class="project-input-row">
                    <input type="text" id="input-annaba" class="project-input" placeholder="Nouveau jalon...">
                    <button onclick="addProjectTask('annaba')" class="btn-icon">+</button>
                </div>
            </div>

            <div class="project-card" style="border-left: 3px solid var(--warn-orange);">
                <div class="project-header">
                    <div class="project-title">üè¢ Copropri√©t√©</div>
                    <span style="font-size:0.7rem; color:var(--text-muted);">Fin: <input type="date" id="date-copro" style="background:none; border:none; color:var(--text-main); font-size:0.7rem;" onchange="saveData()"></span>
                </div>
                <div class="timeline-track"><div class="timeline-bar" id="bar-copro" style="background: linear-gradient(90deg, var(--warn-orange), var(--patri-purple));"></div></div>
                <div id="list-copro"></div>
                <div class="project-input-row">
                    <input type="text" id="input-copro" class="project-input" placeholder="Nouveau jalon...">
                    <button onclick="addProjectTask('copro')" class="btn-icon">+</button>
                </div>
            </div>

            <div class="project-card">
                <div class="project-header"><div class="project-title">üè† Airbnb</div><span style="font-size:0.65rem; color:var(--text-muted);">Hebdo</span></div>
                <div id="list-airbnb"></div>
                <div class="project-input-row">
                    <input type="text" id="input-airbnb" class="project-input" placeholder="T√¢che r√©currente...">
                    <button onclick="addProjectTask('airbnb')" class="btn-icon">+</button>
                </div>
            </div>

            <div class="project-card">
                <div class="project-header"><div class="project-title">üè° Maison</div><span style="font-size:0.65rem; color:var(--text-muted);">Mensuel</span></div>
                <div id="list-maison"></div>
                <div class="project-input-row">
                    <input type="text" id="input-maison" class="project-input" placeholder="T√¢che r√©currente...">
                    <button onclick="addProjectTask('maison')" class="btn-icon">+</button>
                </div>
            </div>
        </section>

        <!-- REVIEW -->
        <section id="view-review" class="view-section">
            <h2 style="margin-bottom:1rem; font-size:1.2rem; font-weight:700;">üìÖ Architecture Semaine</h2>
            <div class="week-grid" id="week-grid"></div>
            <div class="rules-card">
                <h3>‚ö° R√®gles d'Or</h3>
                <ul class="rules-list">
                    <li>18h30-21h30 : Famille INTOUCHABLE</li>
                    <li>22h45 : Shutdown Protocol</li>
                    <li>Top 3 : Max 3 priorit√©s/jour</li>
                    <li>Vendredi : Patrimoine Friday</li>
                    <li>Week-end : Vie + Patrimoine focus</li>
                </ul>
            </div>
            <div class="project-card" style="margin-top:1rem;">
                <div class="pillar-header"><span class="pillar-title">üìù Weekly Review</span></div>
                <div style="display:flex; flex-direction:column; gap:12px;">
                    <div>
                        <label style="font-size:0.7rem; color:var(--text-muted); display:block; margin-bottom:4px;">1. Victoire de la semaine ?</label>
                        <input type="text" id="review-win" class="project-input" style="width:100%;" onchange="saveReview()">
                    </div>
                    <div>
                        <label style="font-size:0.7rem; color:var(--text-muted); display:block; margin-bottom:4px;">2. Ce qui n'a pas fonctionn√© ?</label>
                        <input type="text" id="review-fail" class="project-input" style="width:100%;" onchange="saveReview()">
                    </div>
                    <div>
                        <label style="font-size:0.7rem; color:var(--text-muted); display:block; margin-bottom:4px;">3. PRIORIT√â semaine prochaine ?</label>
                        <input type="text" id="review-priority" class="project-input" style="width:100%;" onchange="saveReview()">
                        <button onclick="createTaskFromPriority()" class="shutdown-btn" style="margin-top:10px; background:var(--saas-green); color:#000;">‚Üí Cr√©er comme TOP 3</button>
                    </div>
                </div>
            </div>
        </section>
    </main>
</div>

<!-- TIMER -->
<div class="timer-float" id="timer-float">
    <div class="timer-time" id="timer-display">00:00</div>
    <button class="timer-btn" id="btn-timer-toggle" onclick="toggleTimer()">‚ñ∂</button>
    <button class="timer-btn" onclick="resetTimer()">‚Ü∫</button>
</div>

<!-- FOCUS -->
<div class="focus-overlay" id="focus-overlay">
    <button class="focus-exit" style="position:absolute; top:20px; right:20px; background:none; border:1px solid #333; color:#666; padding:10px 20px; border-radius:100px; cursor:pointer;" onclick="exitFocusMode()">‚úï Quitter</button>
    <div class="focus-type" id="focus-type-label">PRO</div>
    <div class="focus-task" id="focus-task-text">S√©lectionne une t√¢che</div>
    <div class="focus-timer" id="focus-timer-display">00:00</div>
    <div class="focus-controls" style="display:flex; gap:15px;">
        <button class="focus-btn secondary" id="focus-toggle-btn" onclick="toggleFocusTimer()">‚ñ∂ Timer</button>
        <button class="focus-btn primary" onclick="completeFocusTask()">‚úì TERMIN√â</button>
        <button class="focus-btn secondary" onclick="nextFocusTask()">‚Üí</button>
    </div>
</div>

<!-- SHUTDOWN -->
<div class="modal-overlay" id="shutdown-modal">
    <div class="modal-content">
        <div class="shutdown-title">üåô SHUTDOWN</div>
        <div class="shutdown-subtitle">22h45 ‚Äî Pr√©paration sommeil</div>
        <div style="text-align:left; margin-bottom:1.5rem; display:flex; flex-direction:column; gap:10px;">
            <div style="display:flex; gap:10px;"><input type="checkbox"><label style="color:var(--text-muted); font-size:0.9rem;">Victoire not√©e</label></div>
            <div style="display:flex; gap:10px;"><input type="checkbox"><label style="color:var(--text-muted); font-size:0.9rem;">Top 3 demain:</label></div>
            <input type="text" id="shutdown-tomorrow" class="project-input" placeholder="1. / 2. / 3.">
            <div style="display:flex; gap:10px;"><input type="checkbox"><label style="color:var(--text-muted); font-size:0.9rem;">√âcrans √©teints</label></div>
        </div>
        <button onclick="closeShutdown()" class="shutdown-btn">BONNE NUIT üí™</button>
    </div>
</div>

<!-- AI IMPORT MODAL -->
<div class="modal-overlay" id="ai-import-modal">
    <div class="modal-content">
        <div class="shutdown-title" style="color:var(--patri-purple);">üì• IMPORT IA</div>
        <div class="shutdown-subtitle">Transforme tes PDF en t√¢ches instantan√©ment</div>
        
        <button onclick="copyAgentPrompt()" class="copy-prompt-btn">üìã 1. COPIER LE PROMPT AGENT</button>
        <textarea id="ai-import-text" class="import-area" placeholder='2. Colle le bloc JSON ici (ex: [{"type":"annaba", ...}])'></textarea>
        
        <div style="display:flex; gap:10px;">
            <button onclick="document.getElementById('ai-import-modal').classList.remove('show')" class="shutdown-btn" style="background:var(--bg-subtle); color:var(--text-muted);">ANNULER</button>
            <button onclick="processAiImport()" class="shutdown-btn" style="background:var(--patri-purple); color:white;">IMPORTER</button>
        </div>
    </div>
</div>

<script>
// ===============================================
// AGENT PROMPT STRING
// ===============================================
const AGENT_PROMPT = `
# R√îLE :
Tu es mon "Project Slicer" expert (M√©thodologie GTD + Agile). Je suis Huzine, Tech Manager (Dell).

# MISSION :
Analyse le document ou texte fourni.
1. D√âCOUPE ce projet en actions concr√®tes (45-60 min max).
2. CLASSE-les dans les bonnes cat√©gories.
3. G√âN√àRE UNIQUEMENT UN BLOC JSON strict.

# CAT√âGORIES ("type") :
- "pro" (Dell)
- "saas" (Nutri-Track)
- "vie" (Admin/Famille)
- "annaba" (R√©nov Alg√©rie)
- "copro" (Syndic)
- "airbnb"
- "maison"

# FORMAT DE SORTIE (JSON LIST) :
[
  {"type": "annaba", "text": "Appeler archi pour plan", "priority": "H"},
  {"type": "pro", "text": "Revue trimestrielle", "priority": "M"}
]
`;

// ===============================================
// DATA
// ===============================================
const defaultData = {
    tasks: [],
    metrics: { mrr: '0', users: '0' },
    settings: { annabaDate: '', coproDate: '', crisisMode: false },
    journal: [],
    review: { win: '', fail: '', priority: '' }
};

let data = JSON.parse(localStorage.getItem('huzine_os_v5')) || JSON.parse(JSON.stringify(defaultData));
data.tasks.forEach(t => { if (t.todayStar === undefined) t.todayStar = false; });
if (data.settings.crisisMode === undefined) data.settings.crisisMode = false;

// ===============================================
// DAY CONFIG
// ===============================================
const dayConfig = {
    0: { focus: 'vie', medium: 'patri', light: 'pro', faded: 'saas', label: 'WEEK-END', color: 'var(--vie-pink)' },
    1: { focus: 'pro', medium: 'saas', light: 'vie', faded: 'patri', label: 'PRO FOCUS', color: 'var(--pro-blue)' },
    2: { focus: 'saas', medium: 'pro', light: 'vie', faded: 'patri', label: 'SAAS FOCUS', color: 'var(--saas-green)' },
    3: { focus: 'pro', medium: 'patri', light: 'vie', faded: 'saas', label: 'PRO + PATRI', color: 'var(--pro-blue)' },
    4: { focus: 'saas', medium: 'pro', light: 'vie', faded: 'patri', label: 'SAAS FOCUS', color: 'var(--saas-green)' },
    5: { focus: 'patri', medium: 'pro', light: 'vie', faded: 'saas', label: 'PATRIMOINE', color: 'var(--patri-purple)' },
    6: { focus: 'vie', medium: 'patri', light: 'pro', faded: 'saas', label: 'WEEK-END', color: 'var(--vie-pink)' }
};

const pillarInfo = {
    pro: { icon: 'üíº', name: 'PRO', color: 'var(--pro-blue)', themeClass: 'pro', types: ['pro'] },
    saas: { icon: 'üíª', name: 'SaaS', color: 'var(--saas-green)', themeClass: 'saas', types: ['saas'] },
    vie: { icon: 'üß¨', name: 'Vie', color: 'var(--vie-pink)', themeClass: 'vie', types: ['vie'] },
    patri: { icon: 'üèóÔ∏è', name: 'Patrimoine', color: 'var(--patri-purple)', themeClass: 'patri', types: ['annaba', 'copro', 'airbnb', 'maison'] }
};

// ===============================================
// INIT
// ===============================================
function init() {
    updateClock();
    setInterval(updateClock, 1000);
    setInterval(checkShutdownTime, 60000);
    
    setupDay();
    renderAll();
    renderWeekGrid();
    loadReview();
    cleanJournalIfNewDay();
    updateCrisisUI();
    
    document.getElementById('braindump-input').addEventListener('keypress', e => {
        if (e.key === 'Enter' && e.target.value.trim()) {
            addTask('vie', e.target.value.trim());
            e.target.value = '';
        }
    });
    
    document.getElementById('journal-input').addEventListener('keypress', e => {
        if (e.key === 'Enter' && e.target.value.trim()) addJournalEntry();
    });
}

function saveData() {
    const dateAnnaba = document.getElementById('date-annaba');
    const dateCopro = document.getElementById('date-copro');
    if (dateAnnaba) data.settings.annabaDate = dateAnnaba.value;
    if (dateCopro) data.settings.coproDate = dateCopro.value;
    localStorage.setItem('huzine_os_v5', JSON.stringify(data));
    renderAll();
}

function setupDay() {
    const days = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
    const now = new Date();
    const dayIdx = now.getDay();
    const hour = now.getHours();
    const config = dayConfig[dayIdx];

    const badge = document.getElementById('day-badge');
    const greetingText = document.getElementById('greeting-text');

    if (hour < 12) greetingText.textContent = 'Bon matin';
    else if (hour < 18) greetingText.textContent = 'Bon apr√®s-midi';
    else greetingText.textContent = 'Bonne soir√©e';

    badge.textContent = config.label + ' // ' + days[dayIdx];
    badge.style.background = config.color;
}

// ===============================================
// RENDERING
// ===============================================
function renderPillarGrid() {
    const dayIdx = new Date().getDay();
    const config = dayConfig[dayIdx];
    const grid = document.getElementById('pillar-grid');
    
    const order = [config.focus, config.medium, config.light, config.faded];
    const levels = { [config.focus]: 'focus', [config.medium]: 'medium', [config.light]: 'light', [config.faded]: 'faded' };
    
    grid.innerHTML = order.map(pillarKey => {
        const info = pillarInfo[pillarKey];
        const level = levels[pillarKey];
        const tasks = data.tasks.filter(t => info.types.includes(t.type));
        const activeTasks = tasks.filter(t => !t.done).slice(0, 4);
        const doneCount = tasks.filter(t => t.done).length;
        const totalCount = tasks.length;
        
        return `
            <div class="pillar-card ${level} ${info.themeClass}" style="--theme: ${info.color}">
                ${level === 'focus' ? '<div class="pillar-focus-tag">FOCUS</div>' : ''}
                <div class="pillar-header">
                    <span class="pillar-title" style="color:${info.color}">${info.icon} ${info.name}</span>
                    <span class="pillar-badge">${totalCount - doneCount}</span>
                </div>
                <div class="pillar-tasks">
                    ${activeTasks.length === 0 ? '<div class="top3-empty" style="border:none; padding:0;">Aucune t√¢che</div>' : 
                        activeTasks.map(t => `
                            <div class="task-row">
                                <input type="checkbox" class="task-check" onclick="event.stopPropagation(); toggleTask(${t.id})">
                                <span class="task-content" onclick="startFocusOnTask(${t.id})">${escapeHtml(t.text)}</span>
                                <button class="task-star ${t.todayStar ? 'active' : ''}" onclick="event.stopPropagation(); toggleStar(${t.id})">‚òÖ</button>
                            </div>
                        `).join('')
                    }
                </div>
                <button class="add-task-btn" onclick="addNewTask('${info.types[0]}')">+ Ajouter</button>
            </div>
        `;
    }).join('');
}

function renderTop3() {
    const el = document.getElementById('top3-list');
    const countEl = document.getElementById('top3-count');
    const starred = data.tasks.filter(t => t.todayStar && !t.done);
    countEl.textContent = starred.length + '/3';
    
    if (starred.length === 0) {
        el.innerHTML = '<div class="top3-empty">Clique sur ‚òÖ pour marquer tes priorit√©s</div>';
        return;
    }
    
    const getColor = (type) => {
        if (type === 'pro') return 'var(--pro-blue)';
        if (type === 'saas') return 'var(--saas-green)';
        if (type === 'vie') return 'var(--vie-pink)';
        return 'var(--patri-purple)';
    };
    
    el.innerHTML = starred.map(t => `
        <div class="task-row">
            <input type="checkbox" class="task-check" onclick="event.stopPropagation(); toggleTask(${t.id})">
            <span class="task-type-dot" style="background:${getColor(t.type)}"></span>
            <span class="task-content" onclick="startFocusOnTask(${t.id})">${escapeHtml(t.text)}</span>
            <button class="task-star active" onclick="event.stopPropagation(); toggleStar(${t.id})">‚òÖ</button>
        </div>
    `).join('');
}

function renderTable(elementId, type) {
    const el = document.getElementById(elementId);
    if (!el) return;
    const tasks = data.tasks.filter(t => t.type === type);
    tasks.sort((a, b) => a.done - b.done);

    el.innerHTML = tasks.map(t => `
        <tr class="${t.done ? 'task-done' : ''}">
            <td><input type="checkbox" class="task-check" style="margin:0" ${t.done ? 'checked' : ''} onclick="toggleTask(${t.id})"></td>
            <td style="${t.done ? 'text-decoration:line-through; color:var(--text-dim);' : ''}">${escapeHtml(t.text)}</td>
            <td><button class="task-star ${t.todayStar ? 'active' : ''}" onclick="toggleStar(${t.id})">‚òÖ</button></td>
            <td><button onclick="deleteTask(${t.id})" class="task-delete">‚úï</button></td>
        </tr>
    `).join('');
}

function renderProjectList(elementId, type) {
    const el = document.getElementById(elementId);
    if (!el) return;
    const tasks = data.tasks.filter(t => t.type === type);
    tasks.sort((a, b) => a.done - b.done);

    el.innerHTML = tasks.map(t => `
        <div class="task-row ${t.done ? 'task-done' : ''}">
            <input type="checkbox" class="task-check" ${t.done ? 'checked' : ''} onclick="toggleTask(${t.id})">
            <span class="task-content">${escapeHtml(t.text)}</span>
            <button class="task-star ${t.todayStar ? 'active' : ''}" onclick="toggleStar(${t.id})">‚òÖ</button>
            <button class="task-delete" onclick="deleteTask(${t.id})">‚úï</button>
        </div>
    `).join('');
}

function renderJournal() {
    const el = document.getElementById('journal-entries');
    const today = new Date().toDateString();
    const todayEntries = data.journal.filter(j => j.date === today);
    if (todayEntries.length === 0) { el.innerHTML = '<div style="color:var(--text-dim); font-size:0.7rem; padding:10px 0; font-style:italic;">Aucune entr√©e aujourd\'hui.</div>'; return; }
    el.innerHTML = todayEntries.map(j => `<div class="journal-entry"><span class="journal-time">[${j.time}]</span><span class="journal-text">${escapeHtml(j.text)}</span></div>`).join('');
}

// ===============================================
// LOGIC
// ===============================================
function addTask(type, text, priority = 'M') {
    data.tasks.unshift({
        id: Date.now() + Math.floor(Math.random() * 1000),
        type, text, done: false, priority,
        todayStar: false, createdAt: new Date().toISOString()
    });
    saveData();
}

function toggleTask(id) {
    const task = data.tasks.find(t => t.id === id);
    if (task) { task.done = !task.done; if (task.done) task.todayStar = false; saveData(); }
}

function deleteTask(id) {
    data.tasks = data.tasks.filter(t => t.id !== id);
    saveData();
}

function toggleStar(id) {
    const task = data.tasks.find(t => t.id === id);
    if (!task) return;
    const currentStars = data.tasks.filter(t => t.todayStar && !t.done).length;
    if (task.todayStar) { task.todayStar = false; }
    else if (currentStars < 3) { task.todayStar = true; }
    else { alert('Max 3 t√¢ches TOP !'); return; }
    saveData();
}

function addNewTask(type) {
    const text = prompt(`Nouvelle t√¢che :`);
    if (text && text.trim()) addTask(type, text.trim());
}

function addProjectTask(type) {
    const input = document.getElementById('input-' + type);
    if (input && input.value.trim()) { addTask(type, input.value.trim()); input.value = ''; }
}

function updateProjectProgress(type) {
    const tasks = data.tasks.filter(t => t.type === type);
    const done = tasks.filter(t => t.done).length;
    const total = tasks.length;
    const pct = total > 0 ? Math.round((done / total) * 100) : 0;
    const bar = document.getElementById('bar-' + type);
    if (bar) bar.style.width = pct + '%';
}

function updateMetrics() {
    data.metrics.mrr = document.getElementById('input-mrr').value || '0';
    data.metrics.users = document.getElementById('input-users').value || '0';
    saveData();
}

function addJournalEntry(autoText = null) {
    const input = document.getElementById('journal-input');
    const text = autoText || input.value.trim();
    if (!text) return;
    const now = new Date();
    data.journal.unshift({ time: now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' }), text, date: now.toDateString() });
    if (!autoText) input.value = '';
    saveData();
}

function toggleJournal() {
    const body = document.getElementById('journal-body');
    const toggle = document.getElementById('journal-toggle');
    body.classList.toggle('expanded');
    toggle.textContent = body.classList.contains('expanded') ? '‚ñ≤ Masquer' : '‚ñº Afficher';
}

function cleanJournalIfNewDay() {
    data.journal = data.journal.filter(j => { const d = new Date(j.date); return (new Date() - d) / 86400000 < 7; });
    saveData();
}

function saveReview() {
    data.review.win = document.getElementById('review-win').value;
    data.review.fail = document.getElementById('review-fail').value;
    data.review.priority = document.getElementById('review-priority').value;
    saveData();
}

function loadReview() {
    document.getElementById('review-win').value = data.review.win || '';
    document.getElementById('review-fail').value = data.review.fail || '';
    document.getElementById('review-priority').value = data.review.priority || '';
}

function createTaskFromPriority() {
    const priority = document.getElementById('review-priority').value.trim();
    if (!priority) { alert('Remplis la priorit√© !'); return; }
    const type = prompt('Type ? (pro / saas / vie)', 'pro');
    if (!['pro', 'saas', 'vie'].includes(type)) { alert('Type invalide'); return; }
    addTask(type, priority, 'H');
    const task = data.tasks.find(t => t.text === priority && !t.done);
    if (task) task.todayStar = true;
    saveData();
    alert('T√¢che cr√©√©e et marqu√©e TOP 3 !');
}

function renderWeekGrid() {
    const weekDays = [
        { name: 'Lun', theme: 'PRO', color: 'var(--pro-blue)', idx: 1 },
        { name: 'Mar', theme: 'SaaS', color: 'var(--saas-green)', idx: 2 },
        { name: 'Mer', theme: 'PRO+Patri', color: 'var(--pro-blue)', idx: 3 },
        { name: 'Jeu', theme: 'SaaS', color: 'var(--saas-green)', idx: 4 },
        { name: 'Ven', theme: 'Patrimoine', color: 'var(--patri-purple)', idx: 5 },
        { name: 'W-E', theme: 'Vie', color: 'var(--vie-pink)', idx: 0 }
    ];
    const today = new Date().getDay();
    document.getElementById('week-grid').innerHTML = weekDays.map(d => `
        <div class="week-day ${d.idx === today || (d.idx === 0 && (today === 0 || today === 6)) ? 'today' : ''}">
            <div class="week-day-name" style="color:${d.color}">${d.name}</div>
            <div class="week-day-theme">${d.theme}</div>
        </div>
    `).join('');
}

function renderAll() {
    renderTop3();
    renderPillarGrid();
    renderTable('table-pro-body', 'pro');
    renderTable('table-saas-body', 'saas');
    renderTable('table-vie-body', 'vie');
    renderProjectList('list-annaba', 'annaba');
    renderProjectList('list-copro', 'copro');
    renderProjectList('list-airbnb', 'airbnb');
    renderProjectList('list-maison', 'maison');

    document.getElementById('input-mrr').value = data.metrics.mrr;
    document.getElementById('input-users').value = data.metrics.users;
    if (document.getElementById('date-annaba')) document.getElementById('date-annaba').value = data.settings.annabaDate || '';
    if (document.getElementById('date-copro')) document.getElementById('date-copro').value = data.settings.coproDate || '';

    updateProjectProgress('annaba');
    updateProjectProgress('copro');
    renderJournal();
}

// ===============================================
// IMPORT IA
// ===============================================
function openAiImport() { document.getElementById('ai-import-modal').classList.add('show'); }
function copyAgentPrompt() {
    navigator.clipboard.writeText(AGENT_PROMPT.trim()).then(function() {
        const btn = document.querySelector('.copy-prompt-btn');
        const originalText = btn.innerHTML;
        btn.innerHTML = "‚úÖ PROMPT COPI√â !";
        setTimeout(() => { btn.innerHTML = originalText; }, 2000);
    });
}
function processAiImport() {
    const raw = document.getElementById('ai-import-text').value;
    try {
        const cleanRaw = raw.replace(/```json/g, '').replace(/```/g, '').trim();
        const importedTasks = JSON.parse(cleanRaw);
        if(!Array.isArray(importedTasks)) throw new Error("Format incorrect");
        
        let count = 0;
        importedTasks.forEach(t => { if(t.text && t.type) { addTask(t.type, t.text, t.priority || 'M'); count++; } });
        
        document.getElementById('ai-import-text').value = '';
        document.getElementById('ai-import-modal').classList.remove('show');
        alert(count + " t√¢ches import√©es !");
    } catch(e) { alert("Erreur : JSON invalide."); }
}

// ===============================================
// UI UTILS
// ===============================================
function updateClock() { document.getElementById('clock').textContent = new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' }); }
function checkShutdownTime() { const n = new Date(); if (n.getHours() === 22 && n.getMinutes() === 45) openShutdown(); }
function openShutdown() { document.getElementById('shutdown-modal').classList.add('show'); }
function closeShutdown() { document.getElementById('shutdown-modal').classList.remove('show'); }
function switchTab(viewId, btn) {
    document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
    document.getElementById('view-' + viewId).classList.add('active');
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    if (btn) btn.classList.add('active');
}
function toggleCrisisMode() { data.settings.crisisMode = !data.settings.crisisMode; saveData(); updateCrisisUI(); }
function updateCrisisUI() {
    const header = document.getElementById('main-header');
    const crisisTag = document.getElementById('crisis-tag');
    const btnCrisis = document.getElementById('btn-crisis');
    if (data.settings.crisisMode) { header.classList.add('crisis-active'); crisisTag.classList.remove('hidden'); btnCrisis.classList.add('active'); } 
    else { header.classList.remove('crisis-active'); crisisTag.classList.add('hidden'); btnCrisis.classList.remove('active'); }
}
function escapeHtml(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }
function exportData() { const a = document.createElement('a'); a.href = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(data, null, 2)); a.download = 'huzine_os_' + new Date().toISOString().slice(0, 10) + '.json'; a.click(); }
function importData(input) { const f = input.files[0]; if (!f) return; const r = new FileReader(); r.onload = e => { try { data = JSON.parse(e.target.result); saveData(); alert('Restaur√© !'); location.reload(); } catch { alert('Fichier invalide'); } }; r.readAsText(f); }

// ===============================================
// FOCUS & TIMER
// ===============================================
let focusModeActive = false, focusTimerInterval = null, focusSeconds = 0, currentFocusTaskId = null;
function startFocusOnTask(taskId) {
    const task = data.tasks.find(t => t.id === taskId);
    if (!task || task.done) return;
    currentFocusTaskId = taskId;
    document.getElementById('focus-task-text').textContent = task.text;
    document.getElementById('focus-type-label').textContent = task.type.toUpperCase();
    focusSeconds = 0;
    document.getElementById('focus-timer-display').textContent = '00:00';
    document.getElementById('focus-toggle-btn').textContent = '‚ñ∂ Timer';
    document.getElementById('focus-overlay').classList.add('show');
    focusModeActive = true;
}
function toggleFocusMode() {
    if (focusModeActive) { exitFocusMode(); return; }
    let task = data.tasks.find(t => t.todayStar && !t.done);
    if (!task) task = data.tasks.find(t => !t.done && ['pro', 'saas', 'vie'].includes(t.type));
    if (task) startFocusOnTask(task.id); else alert('Aucune t√¢che active !');
}
function exitFocusMode() { document.getElementById('focus-overlay').classList.remove('show'); focusModeActive = false; currentFocusTaskId = null; clearInterval(focusTimerInterval); focusTimerInterval = null; }
function completeFocusTask() { if (currentFocusTaskId) { const task = data.tasks.find(t => t.id === currentFocusTaskId); if (task) { task.done = true; task.todayStar = false; addJournalEntry(`‚úì ${task.text}`); saveData(); } nextFocusTask(); } }
function nextFocusTask() { clearInterval(focusTimerInterval); focusTimerInterval = null; focusSeconds = 0; let next = data.tasks.find(t => t.todayStar && !t.done && t.id !== currentFocusTaskId); if (!next) next = data.tasks.find(t => !t.done && t.id !== currentFocusTaskId); if (next) startFocusOnTask(next.id); else { document.getElementById('focus-task-text').textContent = 'üéâ Tout est termin√© !'; currentFocusTaskId = null; } }
function toggleFocusTimer() { const btn = document.getElementById('focus-toggle-btn'); if (focusTimerInterval) { clearInterval(focusTimerInterval); focusTimerInterval = null; btn.textContent = '‚ñ∂ Reprendre'; } else { focusTimerInterval = setInterval(() => { focusSeconds++; const m = String(Math.floor(focusSeconds/60)).padStart(2,'0'), s = String(focusSeconds%60).padStart(2,'0'); document.getElementById('focus-timer-display').textContent = m+':'+s; }, 1000); btn.textContent = '‚è∏ Pause'; } }

let timerInterval = null, timerSeconds = 0, isTimerRunning = false;
function toggleTimer() { const btn = document.getElementById('btn-timer-toggle'), tf = document.getElementById('timer-float'); if (isTimerRunning) { clearInterval(timerInterval); isTimerRunning = false; btn.textContent = '‚ñ∂'; tf.classList.remove('active'); } else { timerInterval = setInterval(() => { timerSeconds++; document.getElementById('timer-display').textContent = String(Math.floor(timerSeconds/60)).padStart(2,'0')+':'+String(timerSeconds%60).padStart(2,'0'); }, 1000); isTimerRunning = true; btn.textContent = '‚è∏'; tf.classList.add('active'); } }
function resetTimer() { clearInterval(timerInterval); isTimerRunning = false; timerSeconds = 0; document.getElementById('timer-display').textContent = '00:00'; document.getElementById('btn-timer-toggle').textContent = '‚ñ∂'; document.getElementById('timer-float').classList.remove('active'); }

init();
</script>
</body>
</html>
